!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.JSONPath={})}(this,function(exports){"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var allowedResultTypes=["value","path","pointer","parent","parentProperty","all"],moveToAnotherArray=function(t,e,r){for(var a=t.length,n=0;n<a;n++){r(t[n])&&e.push(t.splice(n--,1)[0])}},vm="undefined"!=typeof module?require("vm"):{runInNewContext:function runInNewContext(expr,context){var keys=Object.keys(context),funcs=[];moveToAnotherArray(keys,funcs,function(t){return"function"==typeof context[t]});var code=funcs.reduce(function(t,e){var r=context[e].toString();return/function/.exec(r)||(r="function "+r),"var "+e+"="+r+";"+t},"")+keys.reduce(function(t,e){return"var "+e+"="+JSON.stringify(context[e]).replace(/\u2028|\u2029/g,function(t){return"\\u202"+("\u2028"===t?"8":"9")})+";"+t},expr);return eval(code)}};function push(t,e){return(t=t.slice()).push(e),t}function unshift(t,e){return(e=e.slice()).unshift(t),e}function NewError(t){this.avoidNew=!0,this.value=t,this.message='JSONPath should not be called with "new" (it prevents return of (unwrapped) scalar values)'}function JSONPath(t,e,r,a,n){if(!(this instanceof JSONPath))try{return new JSONPath(t,e,r,a,n)}catch(t){if(!t.avoidNew)throw t;return t.value}"string"==typeof t&&(n=a,a=r,r=e,e=t,t={});var o=(t=t||{}).hasOwnProperty("json")&&t.hasOwnProperty("path");if(this.json=t.json||r,this.path=t.path||e,this.resultType=t.resultType&&t.resultType.toLowerCase()||"value",this.flatten=t.flatten||!1,this.wrap=!t.hasOwnProperty("wrap")||t.wrap,this.sandbox=t.sandbox||{},this.preventEval=t.preventEval||!1,this.parent=t.parent||null,this.parentProperty=t.parentProperty||null,this.callback=t.callback||a||null,this.otherTypeCallback=t.otherTypeCallback||n||function(){throw new Error("You must supply an otherTypeCallback callback option with the @other() operator.")},!1!==t.autostart){var s=this.evaluate({path:o?t.path:e,json:o?t.json:r});if(!s||"object"!==_typeof(s))throw new NewError(s);return s}}JSONPath.prototype.evaluate=function(t,e,r,a){var n=this,o=this.parent,s=this.parentProperty,i=this.flatten,p=this.wrap;if(this.currResultType=this.resultType,this.currPreventEval=this.preventEval,this.currSandbox=this.sandbox,r=r||this.callback,this.currOtherTypeCallback=a||this.otherTypeCallback,e=e||this.json,(t=t||this.path)&&"object"===_typeof(t)){if(!t.path)throw new Error('You must supply a "path" property when providing an object argument to JSONPath.evaluate().');e=t.hasOwnProperty("json")?t.json:e,i=t.hasOwnProperty("flatten")?t.flatten:i,this.currResultType=t.hasOwnProperty("resultType")?t.resultType:this.currResultType,this.currSandbox=t.hasOwnProperty("sandbox")?t.sandbox:this.currSandbox,p=t.hasOwnProperty("wrap")?t.wrap:p,this.currPreventEval=t.hasOwnProperty("preventEval")?t.preventEval:this.currPreventEval,r=t.hasOwnProperty("callback")?t.callback:r,this.currOtherTypeCallback=t.hasOwnProperty("otherTypeCallback")?t.otherTypeCallback:this.currOtherTypeCallback,o=t.hasOwnProperty("parent")?t.parent:o,s=t.hasOwnProperty("parentProperty")?t.parentProperty:s,t=t.path}if(o=o||null,s=s||null,Array.isArray(t)&&(t=JSONPath.toPathString(t)),t&&e&&allowedResultTypes.includes(this.currResultType)){this._obj=e;var h=JSONPath.toPathArray(t);"$"===h[0]&&h.length>1&&h.shift(),this._hasParentSelector=null;var l=this._trace(h,e,["$"],o,s,r).filter(function(t){return t&&!t.isParentSelector});return l.length?1!==l.length||p||Array.isArray(l[0].value)?l.reduce(function(t,e){var r=n._getPreferredOutput(e);return i&&Array.isArray(r)?t=t.concat(r):t.push(r),t},[]):this._getPreferredOutput(l[0]):p?[]:void 0}},JSONPath.prototype._getPreferredOutput=function(t){var e=this.currResultType;switch(e){case"all":return t.path="string"==typeof t.path?t.path:JSONPath.toPathString(t.path),t;case"value":case"parent":case"parentProperty":return t[e];case"path":return JSONPath.toPathString(t[e]);case"pointer":return JSONPath.toPointer(t.path)}},JSONPath.prototype._handleCallback=function(t,e,r){if(e){var a=this._getPreferredOutput(t);t.path="string"==typeof t.path?t.path:JSONPath.toPathString(t.path),e(a,r,t)}},JSONPath.prototype._trace=function(t,e,r,a,n,o,s){var i,p=this;if(!t.length)return i={path:r,value:e,parent:a,parentProperty:n},this._handleCallback(i,o,"value"),i;var h=t[0],l=t.slice(1),c=[];function u(t){c.push(t)}function f(t){Array.isArray(t)?t.forEach(u):c.push(t)}if(("string"!=typeof h||s)&&e&&Object.prototype.hasOwnProperty.call(e,h))f(this._trace(l,e[h],push(r,h),e,h,o));else if("*"===h)this._walk(h,l,e,r,a,n,o,function(t,e,r,a,n,o,s,i){f(p._trace(unshift(t,r),a,n,o,s,i,!0))});else if(".."===h)f(this._trace(l,e,r,a,n,o)),this._walk(h,l,e,r,a,n,o,function(t,e,r,a,n,o,s,i){"object"===_typeof(a[t])&&f(p._trace(unshift(e,r),a[t],push(n,t),a,t,i))});else{if("^"===h)return this._hasParentSelector=!0,r.length?{path:r.slice(0,-1),expr:l,isParentSelector:!0}:[];if("~"===h)return i={path:push(r,h),value:n,parent:a,parentProperty:null},this._handleCallback(i,o,"property"),i;if("$"===h)f(this._trace(l,e,r,null,null,o));else if(/^(-?[0-9]*):(-?[0-9]*):?([0-9]*)$/.test(h))f(this._slice(h,l,e,r,a,n,o));else if(0===h.indexOf("?(")){if(this.currPreventEval)throw new Error("Eval [?(expr)] prevented in JSONPath expression.");this._walk(h,l,e,r,a,n,o,function(t,e,r,a,n,o,s,i){p._eval(e.replace(/^\?\((.*?)\)$/,"$1"),a[t],t,n,o,s)&&f(p._trace(unshift(t,r),a,n,o,s,i))})}else if("("===h[0]){if(this.currPreventEval)throw new Error("Eval [(expr)] prevented in JSONPath expression.");f(this._trace(unshift(this._eval(h,e,r[r.length-1],r.slice(0,-1),a,n),l),e,r,a,n,o))}else if("@"===h[0]){var y=!1,v=h.slice(1,-2);switch(v){case"scalar":e&&["object","function"].includes(_typeof(e))||(y=!0);break;case"boolean":case"string":case"undefined":case"function":_typeof(e)===v&&(y=!0);break;case"number":_typeof(e)===v&&isFinite(e)&&(y=!0);break;case"nonFinite":"number"!=typeof e||isFinite(e)||(y=!0);break;case"object":e&&_typeof(e)===v&&(y=!0);break;case"array":Array.isArray(e)&&(y=!0);break;case"other":y=this.currOtherTypeCallback(e,r,a,n);break;case"integer":e!==+e||!isFinite(e)||e%1||(y=!0);break;case"null":null===e&&(y=!0)}if(y)return i={path:r,value:e,parent:a,parentProperty:n},this._handleCallback(i,o,"value"),i}else if("`"===h[0]&&e&&Object.prototype.hasOwnProperty.call(e,h.slice(1))){var P=h.slice(1);f(this._trace(l,e[P],push(r,P),e,P,o,!0))}else if(h.includes(","))for(var b=h.split(","),_=0;_<b.length;_++)f(this._trace(unshift(b[_],l),e,r,a,n,o));else!s&&e&&Object.prototype.hasOwnProperty.call(e,h)&&f(this._trace(l,e[h],push(r,h),e,h,o,!0))}if(this._hasParentSelector)for(var d=0;d<c.length;d++){var O=c[d];if(O.isParentSelector){var g=p._trace(O.expr,e,O.path,a,n,o);if(Array.isArray(g)){c[d]=g[0];for(var w=g.length,S=1;S<w;S++)d++,c.splice(d,0,g[S])}else c[d]=g}}return c},JSONPath.prototype._walk=function(t,e,r,a,n,o,s,i){var p,h,l;if(Array.isArray(r))for(p=0,h=r.length;p<h;p++)i(p,t,e,r,a,n,o,s);else if("object"===_typeof(r))for(l in r)Object.prototype.hasOwnProperty.call(r,l)&&i(l,t,e,r,a,n,o,s)},JSONPath.prototype._slice=function(t,e,r,a,n,o,s){if(Array.isArray(r)){var i,p=r.length,h=t.split(":"),l=h[2]&&parseInt(h[2],10)||1,c=h[0]&&parseInt(h[0],10)||0,u=h[1]&&parseInt(h[1],10)||p;c=c<0?Math.max(0,c+p):Math.min(p,c),u=u<0?Math.max(0,u+p):Math.min(p,u);var f=[];for(i=c;i<u;i+=l){var y=this._trace(unshift(i,e),r,a,n,o,s);Array.isArray(y)?y.forEach(function(t){f.push(t)}):f.push(y)}return f}},JSONPath.prototype._eval=function(t,e,r,a,n,o){if(!this._obj||!e)return!1;t.includes("@parentProperty")&&(this.currSandbox._$_parentProperty=o,t=t.replace(/@parentProperty/g,"_$_parentProperty")),t.includes("@parent")&&(this.currSandbox._$_parent=n,t=t.replace(/@parent/g,"_$_parent")),t.includes("@property")&&(this.currSandbox._$_property=r,t=t.replace(/@property/g,"_$_property")),t.includes("@path")&&(this.currSandbox._$_path=JSONPath.toPathString(a.concat([r])),t=t.replace(/@path/g,"_$_path")),t.match(/@([.\s)[])/)&&(this.currSandbox._$_v=e,t=t.replace(/@([.\s)[])/g,"_$_v$1"));try{return vm.runInNewContext(t,this.currSandbox)}catch(e){throw console.log(e),new Error("jsonPath: "+e.message+": "+t)}},JSONPath.cache={},JSONPath.toPathString=function(t){for(var e=t,r=e.length,a="$",n=1;n<r;n++)/^(~|\^|@.*?\(\))$/.test(e[n])||(a+=/^[0-9*]+$/.test(e[n])?"["+e[n]+"]":"['"+e[n]+"']");return a},JSONPath.toPointer=function(t){for(var e=t,r=e.length,a="",n=1;n<r;n++)/^(~|\^|@.*?\(\))$/.test(e[n])||(a+="/"+e[n].toString().replace(/~/g,"~0").replace(/\//g,"~1"));return a},JSONPath.toPathArray=function(t){var e=JSONPath.cache;if(e[t])return e[t].concat();var r=[],a=t.replace(/@(?:null|boolean|number|string|integer|undefined|nonFinite|scalar|array|object|function|other)\(\)/g,";$&;").replace(/[['](\??\(.*?\))[\]']/g,function(t,e){return"[#"+(r.push(e)-1)+"]"}).replace(/\['([^'\]]*)'\]/g,function(t,e){return"['"+e.replace(/\./g,"%@%").replace(/~/g,"%%@@%%")+"']"}).replace(/~/g,";~;").replace(/'?\.'?(?![^[]*\])|\['?/g,";").replace(/%@%/g,".").replace(/%%@@%%/g,"~").replace(/(?:;)?(\^+)(?:;)?/g,function(t,e){return";"+e.split("").join(";")+";"}).replace(/;;;|;;/g,";..;").replace(/;$|'?\]|'$/g,"").split(";").map(function(t){var e=t.match(/#([0-9]+)/);return e&&e[1]?r[e[1]]:t});return e[t]=a,e[t]},exports.JSONPath=JSONPath,Object.defineProperty(exports,"__esModule",{value:!0})});
//# sourceMappingURL=index-umd.min.js.map
